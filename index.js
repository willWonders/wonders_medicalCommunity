let wondersWeChat=require('./wondersWeChat');let wondersCommon=require('./wondersCommon');let medicalCommunity=require('./medicalCommunity');(function(window){function WondersApp(){};var u=navigator.userAgent.toLowerCase();function getQueryVariable(variable){var query=window.location.href.split('?');var vars=query[1]&&query[1].split('&');if(vars&&vars.length){for(var i=0;i<vars.length;i++){var pair=vars[i].split('=');if(pair[0]==variable){return pair[1]}}}return false};function setNativeStorage(data){let key=data.key;if(data.method=='set'){localStorage[key]=data.value}else if(data.method=='delete'){localStorage.removeItem(key)}};WondersApp.prototype.initUrlStorage=function(){let weiXinDATA=JSON.parse(decodeURIComponent(getQueryVariable('weiXinDATA')));let wxData=null;if(weiXinDATA){if(typeof weiXinDATA==='string'){weiXinDATA=JSON.parse(weiXinDATA)}if(weiXinDATA&&weiXinDATA.length){weiXinDATA.forEach((element)=>{wxData={key:element['key'],value:element['value'],method:element['method']?element['method']:'set',};setNativeStorage(wxData)})}}};WondersApp.prototype.QuickVersion={init:WondersApp.prototype.initUrlStorage(),isWeixin:u.indexOf('micromessenger')!=-1,ismedicalCommunityIOS:u.indexOf('ios_medical_community')!=-1,ismedicalCommunity:u.indexOf('ios_medical_community')!=-1||u.indexOf('android_medical_community')!=-1,};WondersApp.prototype.showMapRoute=function(data,callback){if(this.QuickVersion.ismedicalCommunity){medicalCommunity.showMapRoute(data,callback)}else if(this.QuickVersion.isWeixin){wondersWeChat.showMapRoute(data,callback)}else{window.location.href='https://uri.amap.com/navigation?from='+data.sLon+','+data.sLat+',当前位置&to='+data.tLon+','+data.tLat+','+data.sName+'&src=mypage'}};WondersApp.prototype.bluetoothDevice=function(data,callback){if(this.QuickVersion.ismedicalCommunity){medicalCommunity.bluetoothDevice(data,callback)}else{console.log("请在APP端调用")}};WondersApp.prototype.orcIDCard=function(data,callback){if(this.QuickVersion.ismedicalCommunity){medicalCommunity.orcIDCard(data,callback)}else{console.log("请在APP端调用")}};WondersApp.prototype.wxPay=function(data,callback){if(this.QuickVersion.ismedicalCommunity){medicalCommunity.wxPay(data,callback)}else if(this.QuickVersion.isWeixin){wondersWeChat.wxPay(data,callback)}else{console.log('请在APP端调用')}};WondersApp.prototype.qrCodeScan=function(data,callback){if(this.QuickVersion.isWeixin){wondersWeChat.wondersWxJsSDKApi('qrCodeScan',data,callback)}else if(this.QuickVersion.ismedicalCommunity){medicalCommunity.qrCodeScan(data,callback)}else{console.log('请在APP端调用')}};WondersApp.prototype.callPhone=function(data,callback){if(this.QuickVersion.ismedicalCommunity){medicalCommunity.callPhone(data,callback)}else{wondersWeChat.callPhone(data,callback)}};WondersApp.prototype.getVersion=function(data){if(this.QuickVersion.ismedicalCommunity){medicalCommunity.getVersion(data)}else{console.log('请在APP端调用')}};WondersApp.prototype.share=function(data){if(this.QuickVersion.ismedicalCommunity){medicalCommunity.share(data)}else{console.log('请在APP端调用')}};WondersApp.prototype.getLocation=function(data,callback){if(this.QuickVersion.isWeixin){wondersWeChat.wondersWxJsSDKApi('getLocation',data,callback)}else if(this.QuickVersion.ismedicalCommunity){medicalCommunity.getLocation(data,callback)}else{let pageData=data;var url='https://webapi.amap.com/maps?v=1.4.15&key=863ce4441eb85cb737d36126aac8227d&callback=onMapLoad';var jsapi=document.createElement('script');jsapi.charset='utf-8';jsapi.src=url;document.head.appendChild(jsapi);console.log('获取经纬度..');window.onMapLoad=function(){AMap.plugin('AMap.Geolocation',function(){var geolocation=new AMap.Geolocation({enableHighAccuracy:true,timeout:10000,buttonOffset:new AMap.Pixel(10,20),zoomToAccuracy:true,buttonPosition:'RB',});geolocation.getCurrentPosition();AMap.event.addListener(geolocation,'complete',onComplete);AMap.event.addListener(geolocation,'error',onError);function onComplete(data){if(pageData.coordinate=='2'){let locationResult=wondersCommon.gcj02tobd09(data.position.lng,data.position.lat);data.position.lng=locationResult[0];data.position.lat=locationResult[1]}var backData={code:0,msg:'',longitude:data.position.lng,latitude:data.position.lat,};console.log('backData',backData);callback(backData)}function onError(data){console.log('定位出错',data)}})}}};WondersApp.prototype.chooseImage=function(data,callback){if(this.QuickVersion.ismedicalCommunity){medicalCommunity.chooseImage(data,callback)}else if(this.QuickVersion.isWeixin){wondersWeChat.wondersWxJsSDKApi('chooseImage',data,callback)}else{console.log('请在APP端调用')}};WondersApp.prototype.camera=function(data,callback){if(this.QuickVersion.ismedicalCommunity){medicalCommunity.camera(data,callback)}else if(this.QuickVersion.isWeixin){wondersWeChat.wondersWxJsSDKApi('camera',data,callback)}else{console.log('请在APP端调用')}};WondersApp.prototype.nativeStorage=function(data,callback){if(this.QuickVersion.ismedicalCommunity){medicalCommunity.nativeStorage(data,callback)}else{let key=data.key;var result={code:102,msg:'未定义方法',};if(data.method=='get'){result={code:0,msg:'',[key]:localStorage[key],}}else if(data.method=='set'){localStorage[key]=data.value;result={code:0,msg:'',}}else if(data.method=='delete'){localStorage.removeItem(key);result={code:0,msg:'',}}callback(result)}};WondersApp.prototype.nativeVioce=function(callback){if(this.QuickVersion.ismedicalCommunity){medicalCommunity.nativeVioce(callback)}else{console.log('请在APP端调用')}};WondersApp.prototype.nativeSearchVal=function(data){if(this.QuickVersion.ismedicalCommunity){medicalCommunity.nativeSearchVal(data)}else{console.log('请在APP端调用')}};WondersApp.prototype.authentication=function(data,callback){if(this.QuickVersion.ismedicalCommunity){medicalCommunity.authentication(data,callback)}else{console.log('请在APP端调用')}};WondersApp.prototype.authType=function(callback){if(this.QuickVersion.ismedicalCommunity){medicalCommunity.authType(callback)}else{console.log('请在APP端调用')}};WondersApp.prototype.rotate=function(data){if(this.QuickVersion.ismedicalCommunity){medicalCommunity.rotate(data)}else{console.log('请在APP端调用')}};WondersApp.prototype.download=function(data){if(this.QuickVersion.ismedicalCommunity){medicalCommunity.download(data)}else{console.log('请在APP端调用')}};WondersApp.prototype.cacheSize=function(callback){if(this.QuickVersion.ismedicalCommunity){medicalCommunity.cacheSize(callback)}else{console.log('请在APP端调用')}};WondersApp.prototype.clearCache=function(callback){if(this.QuickVersion.ismedicalCommunity){medicalCommunity.clearCache(callback)}else{console.log('请在APP端调用')}};WondersApp.prototype.newMessage=function(data,callback){if(this.QuickVersion.ismedicalCommunity){medicalCommunity.clearCache(data,callback)}else{console.log('请在APP端调用')}};WondersApp.prototype.video=function(data,callback){if(this.QuickVersion.ismedicalCommunity){medicalCommunity.video(data,callback)}else{console.log('请在APP端调用')}};WondersApp.prototype.refreshToken=function(data,callback){if(this.QuickVersion.ismedicalCommunity){medicalCommunity.refreshToken(data,callback)}else{console.log('请在APP端调用')}};WondersApp.prototype.changeRole=function(){if(this.QuickVersion.ismedicalCommunity){medicalCommunity.changeRole()}else{console.log('请在APP端调用')}};WondersApp.prototype.logout=function(){if(this.QuickVersion.ismedicalCommunity){medicalCommunity.logout()}else{console.log('请在APP端调用')}};WondersApp.prototype.tabConfig=function(data){if(this.QuickVersion.ismedicalCommunity){medicalCommunity.tabConfig(data)}else{console.log('请在APP端调用')}};WondersApp.prototype.setHeader=function(data){if(this.QuickVersion.ismedicalCommunity){medicalCommunity.setHeader(data)}else{console.log('请在APP端调用')}};WondersApp.prototype.onVisible=function(callback){if(this.QuickVersion.ismedicalCommunity){medicalCommunity.onVisible(callback)}};WondersApp.prototype.onInvisible=function(callback){if(this.QuickVersion.ismedicalCommunity){medicalCommunity.onInvisible(callback)}};WondersApp.prototype.onDestory=function(callback){if(this.QuickVersion.ismedicalCommunity){medicalCommunity.onDestory(callback)}};WondersApp.prototype.toNative=function(router,nativeData,refreshUrl,animate,hasNavigation,float,){if(this.QuickVersion.ismedicalCommunity){medicalCommunity.toNative(router,nativeData,refreshUrl,animate,hasNavigation,float,)}};WondersApp.prototype.toBack=function(url,nativeData,refreshUrl,hasNavigation,float,){if(this.QuickVersion.ismedicalCommunity){medicalCommunity.toBack(url,nativeData,refreshUrl,hasNavigation,float)}else{if(url){window.location.href=url}else{window.history.back(-1)}}};WondersApp.prototype.toPage=function(url,nativeData,hasNavigation,float,){if(this.QuickVersion.ismedicalCommunity){medicalCommunity.toPage(url,nativeData,hasNavigation,float)}else{window.location.href=url}};var wondersApp=new WondersApp();if(typeof module!=='undefined'&&typeof module.exports!=='undefined'){module.exports=wondersApp}else{window.WondersApp=wondersApp}})(window);