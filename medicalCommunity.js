(function(window){function MedicalCommunityBridge(){var that=this;this.indexCount=1000;this.callAppMap={};this.onPressBackKey=null;window.executeJS=function(callAppIndex,stringResult){that.appCall(callAppIndex,stringResult)}}var u=navigator.userAgent.toLowerCase();MedicalCommunityBridge.prototype.QuickVersion={isWeixin:u.indexOf('micromessenger')!=-1,isApp:u.indexOf('android_medical_community')!=-1,isIOSApp:u.indexOf('ios_medical_community')!=-1};MedicalCommunityBridge.prototype.getAppIndex=function(name){let thisIndex=this.indexCount++;let numString=name+thisIndex.toString();return numString};MedicalCommunityBridge.prototype.callApp=function(params){if(this.QuickVersion.isIOSApp){window.webkit.messageHandlers.nativePermission.postMessage(JSON.stringify(params),)}else if(this.QuickVersion.isApp){window.WDAndroid.nativePermission(JSON.stringify(params))}else{console.log('h5')}};var regNumber=/\d+/;MedicalCommunityBridge.prototype.appCall=function(callAppIndex,stringResult){if(this.callAppMap[callAppIndex]){stringResult=stringResult.replace(/\r/g,"");stringResult=stringResult.replace(/\n/g,"");stringResult=stringResult.replace(/\t/g,"");stringResult=stringResult.replace(/\\/g,"");stringResult=stringResult.replace(/ /g,"");stringResult=stringResult.replace(/"\[{/g,"[{");stringResult=stringResult.replace(/}]"/g,"}]");stringResult=stringResult.replace(/"{"/g,"{\"");stringResult=stringResult.replace(/"}"/g,"\"}");stringResult=stringResult.replace(/}}"/g,"}}");stringResult=stringResult.replace(/]}"/g,"]}");let backData=JSON.parse(stringResult);this.callAppMap[callAppIndex](backData);if(regNumber.test(callAppIndex)&&callAppIndex.indexOf('header')==-1&&callAppIndex.indexOf('newMessage')==-1){this.callAppMap[callAppIndex]=null;delete this.callAppMap[callAppIndex]}else{}}};MedicalCommunityBridge.prototype.showMapRoute=function(data,callback){var appIndex=this.getAppIndex('showMapRoute');if(callback){this.callAppMap[appIndex]=callback}let params={type:'showMapRoute',params:data,callBackMethod:appIndex,};this.callApp(params)};MedicalCommunityBridge.prototype.wxPay=function(data,callback){var appIndex=this.getAppIndex('wxPay');if(callback){this.callAppMap[appIndex]=callback}let params={type:'wxPay',params:data,callBackMethod:appIndex};this.callApp(params)};MedicalCommunityBridge.prototype.bluetoothDevice=function(data,callback){var appIndex=this.getAppIndex("bluetoothDevice");if(callback){this.callAppMap[appIndex]=callback}let params={type:"bluetoothDevice",params:data,callBackMethod:appIndex,};this.callApp(params)};MedicalCommunityBridge.prototype.orcIDCard=function(data,callback){var appIndex=this.getAppIndex("orcIDCard");if(callback){this.callAppMap[appIndex]=callback}let params={type:"orcIDCard",params:data,callBackMethod:appIndex,};this.callApp(params)};MedicalCommunityBridge.prototype.qrCodeScan=function(data,callback){var appIndex=this.getAppIndex('qrCodeScan');if(callback){this.callAppMap[appIndex]=callback}let params={type:'qrCodeScan',params:data,callBackMethod:appIndex};this.callApp(params)};MedicalCommunityBridge.prototype.callPhone=function(data,callback){var appIndex=this.getAppIndex('callPhone');if(callback){this.callAppMap[appIndex]=callback}let params={type:'phone',params:data,callBackMethod:appIndex};this.callApp(params)};MedicalCommunityBridge.prototype.getVersion=function(callback){var appIndex=this.getAppIndex('getVersion');if(callback){this.callAppMap[appIndex]=callback}let params={type:'version',callBackMethod:appIndex};this.callApp(params)};MedicalCommunityBridge.prototype.share=function(data,callback){var appIndex=this.getAppIndex('share');if(callback){this.callAppMap[appIndex]=callback}let params={type:'share',params:data,callBackMethod:appIndex};this.callApp(params)};MedicalCommunityBridge.prototype.getLocation=function(data,callback){var appIndex=this.getAppIndex('getLocation');if(callback){this.callAppMap[appIndex]=callback}let params={type:'location',params:data,callBackMethod:appIndex};this.callApp(params)};MedicalCommunityBridge.prototype.chooseImage=function(data,callback){var appIndex=this.getAppIndex('chooseImage');if(callback){this.callAppMap[appIndex]=callback}let params={type:'photoLibrary',params:data,callBackMethod:appIndex,};this.callApp(params)};MedicalCommunityBridge.prototype.camera=function(data,callback){var appIndex=this.getAppIndex('camera');if(callback){this.callAppMap[appIndex]=callback}let params={type:'camera',params:data,callBackMethod:appIndex};this.callApp(params)};MedicalCommunityBridge.prototype.nativeStorage=function(data,callback){var appIndex=this.getAppIndex('nativeStorage');if(callback){this.callAppMap[appIndex]=callback}let params={type:'nativeStorage',params:data,callBackMethod:appIndex,};this.callApp(params)};MedicalCommunityBridge.prototype.nativeVioce=function(callback){var appIndex=this.getAppIndex('nativeVioce');if(callback){this.callAppMap[appIndex]=callback}let params={type:'voice',callBackMethod:appIndex};this.callApp(params)};MedicalCommunityBridge.prototype.nativeSearchVal=function(data){let params={type:'searchContent',params:data};this.callApp(params)};MedicalCommunityBridge.prototype.authentication=function(data,callback){var appIndex=this.getAppIndex('authentication');if(callback){this.callAppMap[appIndex]=callback}let params={type:'authentication',params:data,callBackMethod:appIndex,};this.callApp(params)};MedicalCommunityBridge.prototype.authType=function(callback){var appIndex=this.getAppIndex('authType');if(callback){this.callAppMap[appIndex]=callback}let params={type:'authType',callBackMethod:appIndex};this.callApp(params)};MedicalCommunityBridge.prototype.rotate=function(data){let params={type:'rotate',params:data};this.callApp(params)};MedicalCommunityBridge.prototype.login=function(data,callback){var appIndex=this.getAppIndex('login');if(callback){this.callAppMap[appIndex]=callback}let params={type:'login',params:data,callBackMethod:appIndex};this.callApp(params)};MedicalCommunityBridge.prototype.download=function(data){let params={type:'download',params:data};this.callApp(params)};MedicalCommunityBridge.prototype.cacheSize=function(callback){var appIndex=this.getAppIndex('cacheSize');if(callback){this.callAppMap[appIndex]=callback}let params={type:'cacheSize',callBackMethod:appIndex};this.callApp(params)};MedicalCommunityBridge.prototype.clearCache=function(callback){var appIndex=this.getAppIndex('clearCache');if(callback){this.callAppMap[appIndex]=callback}let params={type:'clearCache',callBackMethod:appIndex};this.callApp(params)};MedicalCommunityBridge.prototype.newMessage=function(data,callback){var appIndex=this.getAppIndex('newMessage');if(callback){this.callAppMap[appIndex]=callback}let params={type:'newMessage',params:data,callBackMethod:appIndex};this.callApp(params)};MedicalCommunityBridge.prototype.video=function(data,callback){var appIndex=this.getAppIndex('video');if(callback){this.callAppMap[appIndex]=callback}let params={type:'video',params:data,callBackMethod:appIndex};this.callApp(params)};MedicalCommunityBridge.prototype.bluetoothDevice=function(data,callback){var appIndex=this.getAppIndex('bluetoothDevice');if(callback){this.callAppMap[appIndex]=callback}let params={type:'bluetoothDevice',params:data,callBackMethod:appIndex,};this.callApp(params)};MedicalCommunityBridge.prototype.refreshToken=function(data,callback){var appIndex=this.getAppIndex('refreshToken');if(callback){this.callAppMap[appIndex]=callback}let params={type:'refreshToken',params:data,callBackMethod:appIndex,};this.callApp(params)};MedicalCommunityBridge.prototype.changeRole=function(){let params={type:'changeRole',params:{},};this.callApp(params)};MedicalCommunityBridge.prototype.logout=function(){let params={type:'logout',params:{},};this.callApp(params)};MedicalCommunityBridge.prototype.tabConfig=function(data){let params={type:'tabConfig',params:data};this.callApp(params)};MedicalCommunityBridge.prototype.setHeader=function(data){function deepCopy(obj){var newobj=obj.constructor===Array?[]:{};if(typeof obj!=='object'){return obj}else{for(var i in obj){if(typeof obj[i]==='object'){newobj[i]=deepCopy(obj[i])}else{newobj[i]=obj[i]}}}return newobj}let nativeData=deepCopy(data);if(data['right']&&data['right'].length>0){let rightLenth=data['right'].length;for(let i=0,len=rightLenth;i<len;i++){let appIndex='header-right'+i;this.callAppMap[appIndex]=data['right'][i]['callBackMethod'];nativeData['right'][i]['callBackMethod']=appIndex}}if(data['left']&&data['left'].length>0){let leftLenth=data['left'].length;for(let j=0,len=leftLenth;j<len;j++){let appIndex='header-left'+j;this.callAppMap[appIndex]=data['left'][j]['callBackMethod'];nativeData['left'][j]['callBackMethod']=appIndex}}if(data.titleView.searchMethods&&data.titleView.searchMethods.editingdidbegin){let appIndex1='editingdidbegin';this.callAppMap[appIndex1]=data.titleView.searchMethods.editingdidbegin;nativeData.titleView.searchMethods.editingdidbegin=appIndex1}if(data.titleView.searchMethods&&data.titleView.searchMethods.editingdidend){let appIndex2='editingdidend';this.callAppMap[appIndex2]=data.titleView.searchMethods.editingdidend;nativeData.titleView.searchMethods.editingdidend=appIndex2}if(data.titleView.searchMethods&&data.titleView.searchMethods.editingchanged){let appIndex3='editingchanged';this.callAppMap[appIndex3]=data.titleView.searchMethods.editingchanged;nativeData.titleView.searchMethods.editingchanged=appIndex3}if(data.titleView.searchMethods&&data.titleView.searchMethods.editingfinished){let appIndex4='editingfinished';this.callAppMap[appIndex4]=data.titleView.searchMethods.editingfinished;nativeData.titleView.searchMethods.editingfinished=appIndex4}if(data.titleView.callBackMethod){let appIndex5='searchCallBackMethod';this.callAppMap[appIndex5]=data.titleView.callBackMethod;nativeData.titleView.callBackMethod=appIndex5}if(this.QuickVersion.isIOSApp){window.webkit.messageHandlers.setHeader.postMessage(JSON.stringify(nativeData),)}else if(this.QuickVersion.isApp){window.WDAndroid.setHeader(JSON.stringify(nativeData))}};MedicalCommunityBridge.prototype.onVisible=function(onVisible){if(this.QuickVersion.isIOSApp||this.QuickVersion.isApp){this.callAppMap['onVisible']=onVisible}};MedicalCommunityBridge.prototype.onInvisible=function(onInvisible){if(this.QuickVersion.isIOSApp||this.QuickVersion.isApp){this.callAppMap['onInvisible']=onInvisible}};MedicalCommunityBridge.prototype.onDestory=function(onDestory){if(this.QuickVersion.isIOSApp||this.QuickVersion.isApp){this.callAppMap['onDestory']=onDestory}};MedicalCommunityBridge.prototype.toNative=function(router,nativeData,refreshUrl,animate,hasNavigation,float,){var params={type:'Native',toPage:router,params:nativeData!=undefined?nativeData:{},refreshUrl:refreshUrl!=undefined?refreshUrl:'*',animate:animate==undefined?'push':animate,hasNavigation:hasNavigation||'true',float:float||'false',};if(this.QuickVersion.isIOSApp){window.webkit.messageHandlers.forward.postMessage(JSON.stringify(params))}else if(this.QuickVersion.isApp){window.WDAndroid.forward(JSON.stringify(params))}};MedicalCommunityBridge.prototype.toBack=function(url,nativeData,refreshUrl,hasNavigation,float,){let params={type:'H5',toPage:url||'',params:nativeData!=undefined?nativeData:{},refreshUrl:refreshUrl!=undefined?refreshUrl:'*',hasNavigation:hasNavigation||'true',float:float||'false',animate:'pop',};if(this.QuickVersion.isIOSApp){window.webkit.messageHandlers.forward.postMessage(JSON.stringify(params))}else if(this.QuickVersion.isApp){window.WDAndroid.forward(JSON.stringify(params))}};MedicalCommunityBridge.prototype.toPage=function(url,nativeData,hasNavigation,float,){let params={type:'H5',toPage:url,params:nativeData!=undefined?nativeData:{},hasNavigation:hasNavigation||'true',float:float||'false',animate:'push',};if(this.QuickVersion.isIOSApp){console.log('isIOSApp');window.webkit.messageHandlers.forward.postMessage(JSON.stringify(params))}else if(this.QuickVersion.isApp){console.log('isApp');window.WDAndroid.forward(JSON.stringify(params))}else{console.log('H5')}};var medicalCommunity=new MedicalCommunityBridge();if(typeof module!=='undefined'&&typeof module.exports!=='undefined'){module.exports=medicalCommunity}else{window.medicalCommunity=medicalCommunity}})(window);